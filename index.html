<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gemi Kontrol ve LED</title>

<!-- Leaflet CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
  body { margin: 0; font-family: sans-serif; }
  .container { display: flex; height: 100vh; }
  #map { flex: 2; }
  .controls { flex: 1; text-align: center; padding-top: 50px; }
  button { font-size: 24px; padding: 15px; margin: 20px; width: 150px; }
</style>
</head>

<body>
<div class="container">

  <!-- Harita -->
  <div id="map"></div>

  <!-- LED Kontroller -->
  <div class="controls">
    <h2>LED Kontrol</h2>
    <button id="ledOn">LED ON</button>
    <button id="ledOff">LED OFF</button>
  </div>

</div>

<script>
  const espUrl = "barbra-theophanic-dorla.ngrok-free.dev";

  // LED ON
  document.getElementById("ledOn").onclick = () => {
      fetch(`https://${espUrl}/led/on`)
          .then(() => console.log("LED açıldı"))
          .catch(err => console.error("ESP bağlantısı yok:", err));
  };

  // LED OFF
  document.getElementById("ledOff").onclick = () => {
      fetch(`https://${espUrl}/led/off`)
          .then(() => console.log("LED kapandı"))
          .catch(err => console.error("ESP bağlantısı yok:", err));
  };

  // Konum güncelle
  setInterval(() => {
      fetch(`https://${espUrl}/location`)
          .then(res => res.json())
          .then(data => {
              marker.setLatLng([data.lat, data.lon]);
              map.setView([data.lat, data.lon]);
          })
          .catch(err => console.error("ESP bağlantısı yok:", err));
  }, 3000);
</script>
</body>
</html>
